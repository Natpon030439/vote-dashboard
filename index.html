<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: "Prompt", sans-serif;
      background: #fffafc;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #ff6f91;
    }
    .container {
      max-width: 900px;
      margin: auto;
    }
    .card {
      background: #ffffffcc;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    input[type="text"] {
      width: 70%;
      padding: 10px;
      border: 2px solid #ffd6e0;
      border-radius: 10px;
      outline: none;
    }
    button {
      background: linear-gradient(45deg, #ffb6c1, #ffd6e0);
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      color: #333;
      font-weight: bold;
      margin-left: 5px;
      transition: transform 0.2s;
    }
    button:hover {
      transform: scale(1.05);
    }
    .info {
      text-align: center;
      font-size: 18px;
      color: #666;
    }
    .chart-buttons {
      text-align: center;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üå∏ ‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå üå∏</h1>

    <div class="card">
      <p>‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App:</p>
      <input type="text" id="urlInput" placeholder="https://script.google.com/macros/s/.../exec">
      <button onclick="setURL()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
    </div>

    <div class="card chart-buttons">
      <button onclick="switchChart('bar')">‡πÅ‡∏ó‡πà‡∏á</button>
      <button onclick="switchChart('pie')">‡∏ß‡∏á‡∏Å‡∏•‡∏°</button>
    </div>

    <div class="card">
      <canvas id="voteChart"></canvas>
    </div>

    <div class="card info">
      <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÇ‡∏´‡∏ß‡∏ï‡∏£‡∏ß‡∏°: <span id="totalVotes">0</span></p>
      <p>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="lastUpdate">-</span></p>
    </div>
  </div>

  <script>
    let apiUrl = "";
    let chart;
    let chartType = "bar"; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

    const ctx = document.getElementById('voteChart').getContext('2d');
    const pastelColors = ['#ffb6c1','#ffd6e0','#a5dee5','#d5a6e9','#fff5ba','#b5ead7'];

    function setURL() {
      apiUrl = document.getElementById("urlInput").value;
      fetchData();
      setInterval(fetchData, 3000);
    }

    function switchChart(type) {
      chartType = type;
      if (chart) {
        chart.destroy(); // ‡∏•‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤
        chart = null;
      }
      fetchData(); // ‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà
    }

    async function fetchData() {
      if (!apiUrl) return;
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();

        const labels = data.rows.map(r => r.option);
        const counts = data.rows.map(r => r.count);

        if (!chart) {
          chart = new Chart(ctx, {
            type: chartType,
            data: {
              labels: labels,
              datasets: [{
                label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÇ‡∏´‡∏ß‡∏ï',
                data: counts,
                backgroundColor: pastelColors,
                borderRadius: chartType === 'bar' ? 10 : 0
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: chartType === 'pie' }
              },
              scales: chartType === 'bar' ? {
                y: { beginAtZero: true }
              } : {}
            }
          });
        } else {
          chart.data.labels = labels;
          chart.data.datasets[0].data = counts;
          chart.update();
        }

        document.getElementById("totalVotes").textContent = data.total;
        document.getElementById("lastUpdate").textContent = new Date(data.updated_at).toLocaleTimeString();
      } catch (err) {
        console.error("Fetch error:", err);
      }
    }
  </script>
</body>
</html>

